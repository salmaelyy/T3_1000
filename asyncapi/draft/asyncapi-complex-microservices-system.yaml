asyncapi: 2.6.0
info:
  title: Complex Microservices System
  version: 1.0.0

servers:
  kafkaBroker:
    url: localhost:9092
    protocol: kafka

channels:
  userSignedUp:
    description: User registration event
    publish:
      operationId: authService_publishUserSignedUp
      message:
        $ref: '#/components/messages/UserSignedUp'
    subscribe:
      operationId: analyticsService_consumeUserSignedUp
      message:
        $ref: '#/components/messages/UserSignedUp'

  welcomeEmailSent:
    description: Welcome email sent event
    publish:
      operationId: emailService_publishWelcomeEmailSent
      message:
        $ref: '#/components/messages/WelcomeEmailSent'
    subscribe:
      operationId: analyticsService_consumeWelcomeEmailSent
      message:
        $ref: '#/components/messages/WelcomeEmailSent'

  userProfileCreated:
    description: User profile creation event
    publish:
      operationId: profileService_publishUserProfileCreated
      message:
        $ref: '#/components/messages/UserProfileCreated'
    subscribe:
      operationId: notificationService_consumeUserProfileCreated
      message:
        $ref: '#/components/messages/UserProfileCreated'
    subscribe2:
      operationId: analyticsService_consumeUserProfileCreated
      message:
        $ref: '#/components/messages/UserProfileCreated'

  passwordResetRequested:
    description: Password reset event
    publish:
      operationId: userService_publishPasswordResetRequested
      message:
        $ref: '#/components/messages/PasswordResetRequested'
    subscribe:
      operationId: emailService_consumePasswordResetRequested
      message:
        $ref: '#/components/messages/PasswordResetRequested'
    subscribe2:
      operationId: analyticsService_consumePasswordResetRequested
      message:
        $ref: '#/components/messages/PasswordResetRequested'

components:
  messages:
    UserSignedUp:
      name: UserSignedUp
      title: User signed up event
      payload:
        type: object
        properties:
          userId:
            type: string
          email:
            type: string
    WelcomeEmailSent:
      name: WelcomeEmailSent
      title: Welcome email sent event
      payload:
        type: object
        properties:
          userId:
            type: string
          timestamp:
            type: string
    UserProfileCreated:
      name: UserProfileCreated
      title: User profile created event
      payload:
        type: object
        properties:
          userId:
            type: string
          profileId:
            type: string
    PasswordResetRequested:
      name: PasswordResetRequested
      title: Password reset requested event
      payload:
        type: object
        properties:
          userId:
            type: string
          resetToken:
            type: string
